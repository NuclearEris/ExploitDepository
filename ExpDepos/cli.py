#!/usr/bin/env python
# -*- coding:UTF-8 -*-

"""
@Author: Castiel
@Email:  ca3tie1@gmail.com
@Blog:   https://ca3tie1.github.io
@Git:    https://github.com/ca3tie1
@Wechat: Ca5tie1
@Date:   2021/3/13 12:07
"""

import os
import sys

try:
    import ExpDepos
except ImportError:
    sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), os.path.pardir)))

from ExpDepos.libs.core.ModuleLoader import ModuleLoader
from ExpDepos.libs.core.common.Common import *
from ExpDepos.libs.core.base.ExceptionBase import *


def cli_init():
    # 初始化环境
    env_init()
    # 解析命令行参数
    parse_options()
    test()


def cli_run():
    show_banner()
    cli_init()


def test():
    module_exp = ModuleLoader.load_module_from_file(env.CliOptions.module
                                                    .replace("\\", os.sep)
                                                    .replace("/", os.sep))
    try:
        module_exp.set_option("UserName", "admin")
    except ExpDeposValidationException as error:
        console.exception(repr(error))
    console.info(f"{module_exp.NAME} Options: {module_exp._options()}")
    module_exp.run()


if __name__ == "__main__":
    try:
        cli_run()
    except Exception as e:
        console.exception(repr(e))
    finally:
        pass
