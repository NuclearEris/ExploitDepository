#!/usr/bin/env python

"""
@Author: Castiel
@Email:  ca3tie1@gmail.com
@Blog:   https://ca3tie1.github.io
@Git:    https://github.com/ca3tie1
@Wechat: Ca5tie1
@Date:   2022/4/11 10:05
"""

from ExpDepos.libs.core.common.Enums import FINGERPRINT

"""
本模块用于过滤whatweb-plus中一些无用或者分类不正确的指纹，针对文件名的过滤可以使用通配符 '*' 和 '?'

FILE_BLACK_LIST         定义的列表为whatweb-plus完全可以舍弃的无用指纹

NEED_ADN_LOGIC_LIST     定义的列表为whatweb-plus中匹配项应该使用逻辑and运算进行匹配的指纹 例如 "蓝凌oa-ekp.rb" 中的匹配项
                        {:search=>"all", :text=>'EKP'}和{:search=>"all", :text=>'蓝凌OA'} 前者匹配范围太广 应该与后
                        者同时满足才算匹配成功

MATCHES_BLACK_VALUES    定义的列表为一些可以舍弃的匹配项的列表 例如 "prototype.rb" 中已有两个较高精度的匹配项 然后另外匹配项
                        {:search=>"all", :text=>'Prototype'}范围过于广泛 则需要单独屏蔽掉该匹配项
                        
FINGERPRINT_TYPES       分类修正字典用于修正whatweb-plus中一些分类不准确的指纹 且分类值可以使用列表类型设置指纹归属多个分类 例
                        如一些安全设备的后台管理系统也可以分类到WEB应用类中 以便在只扫描WEB应用的时候也能发现安全设备的后台系统
"""

# 文件黑名单列表
FILE_BLACK_LIST = ["edgecast-waf.rb", "crossdomain.xml.rb", "cookies.rb", "html5.rb", "httponly.rb", "gauges.rb",
                   "conn-keepalive.rb", "microsoft-isa-server.rb", "jquery*", "script.rb", "bootstrap-cdn.rb",
                   "frontpage.rb", "layui.rb", "yui.rb", "three.js.rb", "password-field.rb", "cadvisor.rb",
                   "powered-by.rb", "meta-powered-by.rb", "nuxt.js.rb", "meta-generator.rb", "eclass.rb", "frame.rb",
                   "nginx-generic-protection-waf.rb", "animate.css.rb", "apache-kylin.rb", "interact.rb", "iframe.rb",
                   "国家数字化学习资源中心系统.rb", "embed-json.rb", "sogo.rb", "apollo.rb", "aten.rb",
                   "axis-network-print-server.rb", "google-font-api.rb", "font-awesome.rb", "level3.rb", "snews.rb",
                   "meta-generator.rb", "又拍云js库.rb", "easytrace-botwave.rb", "owl-carousel.rb", "ionicons.rb",
                   "hudson.rb", "meta-author.rb", "prism.rb", "jsdelivr.rb", "gravatar.rb", "bubble.rb", "阿里邮箱.rb",
                   "semantic-ui.rb", "网动云视讯平台.rb", "informix.rb", "sql-server.rb", "particles.js",
                   "facebook-insights.rb", "bolt.rb", "open-graph-protocol.rb", "backpack.rb", "google-tag-manager.rb",
                   "dart.rb", "d3.rb", "oauth2.rb", "strict-transport-security.rb", "pure-css.rb", "hammer.js.rb",
                   "highcharts.rb", "chart.js.rb", "Apache-Struts2.rb"]

# 需要and运算逻辑的列表
NEED_ADN_LOGIC_LIST = ["蓝凌oa-ekp.rb", "ymails-智能反垃圾邮件系统.rb", "第三方国际包裹处理系统-roms.rb",
                       "rums-科创站群管理平台.rb", "方卡在线-isite.rb", "wcm-拓尔思cms-trs.rb",
                       "zcms-泽元网站内容管理系统.rb", "linkedin.rb"]

# 匹配值黑名单
MATCHES_BLACK_VALUES = ["powered by", "error", "openresty", "prototype", "webpack", "everything",
                        "comScore", "Backdrop", "indexLeft", "Amazon"]
# 分类修正列表
FINGERPRINT_TYPES = {"goserve.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "gzip-encode.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "chunked-encode.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "ubuntu.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "windows-32bit.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "windows-64bit.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "windows-ce.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "windows-server.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "asp.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "x-ua-compatible.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "baidu-analytics-百度统计.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "bootstrap*": FINGERPRINT.FP_TYPE.OTHER,
                     "cnzz.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "email.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "mod-fcgid.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "openssl.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "swiper-slider.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "qq*聊天.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "企业版qq.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "polyfill.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "google-font-api.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "access-control-allow-methods.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "sogou站长平台.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "a-frame.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "tinymce.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "kestrel.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "tengine.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "iis.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "microsoft-httpapi.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "apache-tomcat.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "apache.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "layui后台管理系统.rb": FINGERPRINT.FP_TYPE.WEBAPP,
                     "ngx-openresty.rb": FINGERPRINT.FP_TYPE.WEBAPP,
                     "google-api.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "Apache-Struts2.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "apache-shiro.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "apache-haus.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "vue.js.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "Grafana.rb": FINGERPRINT.FP_TYPE.WEBAPP,
                     "MinIO.rb": FINGERPRINT.FP_TYPE.WEBAPP,
                     "Shopify.rb": FINGERPRINT.FP_TYPE.WEBAPP,
                     "nginx.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "index-of.rb": FINGERPRINT.FP_TYPE.VULNERABILITY,
                     "asp.net-requestvalidationmode-microsoft.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "amazon-web-services-web-application-firewall-waf.rb": FINGERPRINT.FP_TYPE.DEVICE,
                     "jsp.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "jspx.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "wordpress-plugin-woocommerce.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "wordpress-plugin-all-in-one-seo-pack.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "woocommerce.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "Php.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "debian.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "huaweicloud-waf.rb": FINGERPRINT.FP_TYPE.DEVICE,
                     "open-search.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "centos.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "requirejs.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "modernizr.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "cdnjs.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "sensors-data.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "p3p-enabled.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "bws.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "tencent-waterproof-wall.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "google-hosted-libraries": FINGERPRINT.FP_TYPE.OTHER,
                     "swagger-ui.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "telescope.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "LNMP.rb": [FINGERPRINT.FP_TYPE.PLATFORM, FINGERPRINT.FP_TYPE.WEBAPP],
                     "mariadb.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "raspbian.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "werkzeug.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "python.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "postgresql.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "sendmail.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "firebird.rb": FINGERPRINT.FP_TYPE.MIDDLEWARE,
                     "hfs.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "basic-auth.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "basic.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "yoast-seo.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "django.rb": [FINGERPRINT.FP_TYPE.PLATFORM, FINGERPRINT.FP_TYPE.WEBAPP],
                     "_viewstate.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "vue框架.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "websocket.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "robin.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "iis10.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "iis8.5.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "microsoft-asp.net.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "asp.net-version.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "asp.net.rb": FINGERPRINT.FP_TYPE.PLATFORM,
                     "google-pagespeed.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "pagespeed.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "认证页面.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "360站长平台.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "baidu站长平台.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "百度cdn.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "element-ui.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "particles.js.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "*.js.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "angularjs.rb": FINGERPRINT.FP_TYPE.OTHER,
                     "sweetalert*.rb": FINGERPRINT.FP_TYPE.OTHER
                     }
